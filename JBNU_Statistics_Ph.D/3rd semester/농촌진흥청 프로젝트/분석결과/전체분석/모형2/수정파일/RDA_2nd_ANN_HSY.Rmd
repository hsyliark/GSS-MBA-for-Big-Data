---
title: "RDA project"
author: "JBNU statistics"
date: '2021 12 06 '
output: html_document
---

## 목적 : 단동 비닐하우스 환기율 및 온습도에 대한 예측모형 구축 및 평가
## 사용모형 : Multiple Linear Regression Model v.s Artificial Neural Network Model (ANN)

## 1. Loading data (내부기온 반응변수)

- 작물있음 데이터에서 외부CO2의 값이 결측치인 경우는 제외하였음.

```{r}
plantyes <- read.csv("C:/Users/HSY/Desktop/작물있음.csv",sep=",",header=T)
plantyes <- plantyes[is.na(plantyes$외부CO2)==FALSE,]
head(plantyes,10)
plantyes$작물유무 <- as.factor(plantyes$작물유무)
plantno <- read.csv("C:/Users/HSY/Desktop/작물없음.csv",sep=",",header=T)
head(plantno,10) 
plantno$작물유무 <- as.factor(plantno$작물유무)
plant <- rbind(plantno,plantyes)
```




## Artificial Neural Network Model (ANN)

- ANN의 경우는 작물이 없을 때와 작물이 있을 때로 나누어 각각 모형을 적합하고 분석을 실시한다.
- 모형적합은 데이터에서 임의로 70%를 추출한 train data를 이용하여 만들고 이 모형의 성능을 판단하기 위해 나머지 30%를 test data로 두어서 test RMSE를 계산한다.

## 3. 작물유무에 따라 데이터를 나누어 적합하는 경우

### Loading packages

```{r}
library(nnet)
library(devtools)
library(neuralnet)
library(NeuralNetTools)
```


### 3.1 작물이 없을 때

- 적합모형은 hidden layer 1개, layer에 대한 node 10개인 모형이다.

```{r}
set.seed(5790)
train.index <- sample(1:nrow(plantno), round(nrow(plantno)*7/10), replace=F)
ex1_train <-plantno[train.index,]
ex1_test <- plantno[-train.index,]
set.seed(1234)
ann1 <- neuralnet(내부기온~환기율+외부기온+외부풍속+외부일사량+환기창면적, data=ex1_train, hidden=10, threshold = 0.01, stepmax = 1e+08)
summary(ann1)
y_hat_ann1 <- compute(ann1, ex1_test)$net.result
RMSE <- mean(sum((ex1_test$환기율-y_hat_ann1)^2))
RMSE
```

- 모형을 적합하는 데 약 1시간이 소요되었다.
- 적합결과 test RMSE의 값이

### 3.2 작물이 있을 때

- 적합모형은 hidden layer 1개, layer에 대한 node 8개인 모형이다.


```{r}
set.seed(5790)
train.index <- sample(1:nrow(plantyes), round(nrow(plantyes)*7/10), replace=F)
ex1_train <-plantyes[train.index,]
ex1_test <- plantyes[-train.index,]
set.seed(1234)
ann1 <- neuralnet(내부기온~환기율+외부기온+외부풍속+외부일사량+환기창면적, data=ex1_train, hidden=8, threshold = 0.01, stepmax = 1e+08)
summary(ann1)
y_hat_ann1 <- compute(ann1, ex1_test)$net.result
RMSE <- mean(sum((ex1_test$환기율-y_hat_ann1)^2))
RMSE
```

- 적합결과 test RMSE의 값이 267169.1로써 다중회귀모형
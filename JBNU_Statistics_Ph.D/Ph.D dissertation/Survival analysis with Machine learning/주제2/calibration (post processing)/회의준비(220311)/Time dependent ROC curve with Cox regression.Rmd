---
title: "Time dependent ROC curve with Cox regression"
author: "Hwang Seong-Yun"
date: '2022 3 4 '
output: html_document
---

# Time dependent ROC curve with Cox regression

## Loading packages

```{r}
library(survival)
library(timeROC)
library(timereg)
```

## pbc data

```{r}
data(pbc)
pbc<-pbc[!is.na(pbc$trt),] # select only randomized subjects
pbc$status<-as.numeric(pbc$status==2) # create event indicator: 1 for death, 0 for censored
head(pbc)
```

### Calculate risk score with Cox proportional hazard model

```{r}
cox.pbc <- coxph(Surv(time,status) ~ ., data=pbc)
summary(cox.pbc)
risk.pbc <- predict(object=cox.pbc, newdata=pbc, type="risk") # risk score
pbc$risk <- risk.pbc
head(pbc)
```

### Time dependent AUC with risk score

```{r}
ROC.risk.marginal <- timeROC(T=pbc$time,
                         delta=pbc$status,marker=pbc$risk,
                         cause=1,weighting="marginal",
                         times=pbc$time)
plot(x=ROC.risk.marginal[["times"]],y=ROC.risk.marginal[["AUC"]],
     type='l',xlab="times",ylab="AUC",
     main="Time dependent AUC with risk score")
```


